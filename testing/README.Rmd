<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r "setup", include = FALSE}
library(rcmdcheck)
library(knitr)
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  echo = FALSE,
  results = "hide"
)
```

# Testing medicalcoder

Along with GitHub Actions and local tests, the workflow in this directory will
test a recent local build of `medicalcoder` against every major and minor
release of R from 3.5.0 through the latest version, with, and without, suggested
packages.  The tests are done in [Docker](https://www.docker.com/) images based
on the [R-base](https://hub.docker.com/_/r-base) images.

## System Requirements:
To run the tests you need

* [Docker Desktop](https://www.docker.com/products/docker-desktop/)
* [GNU Make](https://www.gnu.org/software/make/)

Just run `make` from this directory.

# Last Testing Results

```{r}
check_logs <- list.files(path = ".", pattern = "00check.log", full.name = TRUE, recursive = TRUE)
checks <- sapply(check_logs, parse_check, simplify = FALSE)

DF <-
  checks |>
  sapply(
    function(x) {
      with(x,
        data.frame(
          rversion,
          status,
          errors = ifelse(length(errors), errors, ""),
          warnings = ifelse(length(warnings), warnings, ""),
          notes    = ifelse(length(notes), notes, ""),
          checkdir,
          version
        )
      )
    },
  simplify = FALSE
  )

DF <- do.call(rbind, DF)
rownames(DF) <- NULL

DF$suggests <-
  ifelse(grepl("R-.+without-suggests.+$", DF$checkdir), "Without", "With")
```

```{r results = "asis"}
kableExtra::kbl(
  x = DF[, c("suggests", "status", "errors", "warnings", "notes")],
  col.names = c("Suggested Packages", "Status", "Errors", "Warnings", "Notes"),
  align = "cccccc",
  format = "markdown"
  ) |>
kableExtra::pack_rows(index = table(DF$rversion)) |>
kableExtra::kable_paper(lightable_options = "striped")
```

